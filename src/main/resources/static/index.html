<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Add Module</title>
    <style>
        /* CSS für das Popup-Fenster */
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ffffff;
            padding: 20px;
            border: 1px solid #cccccc;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 9999;
        }
    </style>
</head>
<body>
<h1>Add Module</h1>

<!-- Button zum Anzeigen des Popup-Fensters zum Erstellen eines Moduls -->
<button id="show-add-module-popup-button">Modul erstellen</button>

<h2>Liste aller Module</h2>
<table id="module-table">
    <thead>
    <tr>
        <th>Module ID</th>
        <th>Name</th>
        <th>Beschreibung</th>
        <th>ECTS</th>
        <th>Dozent</th>
        <th>Lehrstuhl</th>
        <th>Regeltermin</th>
        <th>Literaturempfehlung</th>
        <th>Mindestsemester</th>
        <th>Klausurtermin setzen</th>
    </tr>
    </thead>
    <tbody id="module-list">
    <!-- Hier werden die Module angezeigt -->
    </tbody>
</table>

<!-- Popup-Formular zum Erstellen eines Moduls -->
<div id="add-module-popup" class="popup">
    <h2>Modul erstellen</h2>
    <form id="add-module-form">
        <label for="name">Name:</label><br>
        <input type="text" id="name" name="name" required><br>
        <label for="beschreibung">Beschreibung:</label><br>
        <input type="text" id="beschreibung" name="beschreibung" required><br>
        <label for="ects">ECTS:</label><br>
        <input type="number" id="ects" name="ects" required><br>
        <label for="dozent">Dozent:</label><br>
        <input type="text" id="dozent" name="dozent" required><br>
        <label for="lehrstuhl">Lehrstuhl:</label><br>
        <input type="text" id="lehrstuhl" name="lehrstuhl" required><br>
        <label for="regeltermin">Regeltermin:</label><br>
        <input type="text" id="regeltermin" name="regeltermin" required><br>
        <label for="literaturempfehlung">Literaturempfehlung:</label><br>
        <input type="text" id="literaturempfehlung" name="literaturempfehlung"><br>
        <label for="minSemester">Mindestsemester:</label><br>
        <input type="number" id="minSemester" name="minSemester" required><br><br>
        <button type="submit">Modul erstellen</button>
        <button type="button" id="hide-add-module-popup-button">Abbrechen</button>
    </form>
</div>
<script>
    // Event Listener für das Absenden des Modul-Erstellungsformulars
    document.getElementById('add-module-form').addEventListener('submit', async function(event) {
        event.preventDefault(); // Verhindert das Standardverhalten des Formulars (Seitenneuladen)

        // Extrahiere die Daten aus den Formularfeldern
        const moduleData = {
            name: document.getElementById('name').value,
            beschreibung: document.getElementById('beschreibung').value,
            ects: parseInt(document.getElementById('ects').value),
            dozent: document.getElementById('dozent').value,
            lehrstuhl: document.getElementById('lehrstuhl').value,
            regeltermin: document.getElementById('regeltermin').value,
            literaturempfehlung: document.getElementById('literaturempfehlung').value,
            minSemester: parseInt(document.getElementById('minSemester').value)
        };

        try {
            // Sende einen POST-Request an den Server zum Hinzufügen eines neuen Moduls
            const response = await fetch('/klausur/add', { // Stelle sicher, dass diese URL korrekt ist
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(moduleData)
            });
            const newModule = await response.json();

            if (response.ok) {
                alert('Modul erfolgreich erstellt: ' + newModule.name);
                document.getElementById('add-module-popup').style.display = 'none'; // Verstecke das Popup
                loadModules(); // Lade die Module neu, um die Änderungen anzuzeigen
            } else {
                alert('Fehler beim Erstellen des Moduls');
            }
        } catch (error) {
            console.error('Fehler beim Senden der Daten: ', error);
            alert('Fehler beim Verarbeiten Ihrer Anfrage');
        }
    });
</script>


<!-- Popup-Formular für Klausurtermin -->
<div id="klausur-popup" class="popup">
    <h2>Klausurtermin setzen</h2>
    <form id="klausur-termin-form">
        <label for="klausurDatum">Klausurdatum:</label><br>
        <input type="date" id="klausurDatum" name="klausurDatum" required><br>
        <label for="klausurName">Klausurname:</label><br>
        <input type="text" id="klausurName" name="klausurName" required><br>
        <label for="maxPlätze">Maximale Plätze:</label><br>
        <input type="number" id="maxPlätze" name="maxPlätze" required><br><br>
        <button type="submit">Klausurtermin setzen</button>
        <button type="button" id="hide-klausur-popup-button">Abbrechen</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Funktionen und Event Listener für das Anzeigen und Verstecken der Popups
        document.getElementById('show-add-module-popup-button').addEventListener('click', function() {
            document.getElementById('add-module-popup').style.display = 'block';
        });

        document.getElementById('hide-add-module-popup-button').addEventListener('click', function() {
            document.getElementById('add-module-popup').style.display = 'none';
        });

        document.getElementById('hide-klausur-popup-button').addEventListener('click', function() {
            document.getElementById('klausur-popup').style.display = 'none';
        });

        // Funktion zum Laden und Anzeigen der Module
        async function loadModules() {
            const response = await fetch('/modules/all'); // Annahme: Die URL muss entsprechend angepasst werden
            const modules = await response.json();
            const moduleList = document.getElementById('module-list');
            moduleList.innerHTML = ''; // Leere die Modulliste vor dem Hinzufügen neuer Elemente

            modules.forEach(module => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${module.moduleId}</td>
                    <td>${module.name}</td>
                    <td>${module.beschreibung}</td>
                    <td>${module.ects}</td>
                    <td>${module.dozent}</td>
                    <td>${module.lehrstuhl}</td>
                    <td>${module.regeltermin}</td>
                    <td>${module.literaturempfehlung}</td>
                    <td>${module.minSemester}</td>
                    <td><button class="show-klausur-popup-button" data-module-id="${module.moduleId}">Klausurtermin setzen</button></td>
                `;
                moduleList.appendChild(row);
            });

            // Füge Event Listener für die neuen Klausurtermin-Buttons hinzu
            document.querySelectorAll('.show-klausur-popup-button').forEach(button => {
                button.addEventListener('click', function() {
                    const moduleId = this.dataset.moduleId;
                    document.getElementById('klausur-popup').style.display = 'block';
                    document.getElementById('klausur-popup').setAttribute('data-module-id', moduleId);
                });
            });
        }

        // Event Listener für das Absenden des Klausurtermin-Formulars
        document.getElementById('klausur-termin-form').addEventListener('submit', async function(event) {
            event.preventDefault(); // Verhindert das Standardverhalten des Formulars
            const moduleId = document.getElementById('klausur-popup').getAttribute('data-module-id');
            const klausurDatum = document.getElementById('klausurDatum').value;
            const klausurName = document.getElementById('klausurName').value;
            const maxPlätze = document.getElementById('maxPlätze').value;

             await fetch(`/klausur/${moduleId}/add`, {
               method: 'POST',
               headers: {
                 'Content-Type': 'application/json'
               },
               body: JSON.stringify({ klausurDatum, klausurName, maxPlätze })
             });

            document.getElementById('klausur-popup').style.display = 'none'; // Verstecke das Popup nach dem Absenden
        });

        loadModules(); // Lade die Module beim initialen Laden der Seite
    });
</script>
</body>
</html>
